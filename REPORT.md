Report: Antibiotic Resistance and Consumption
==================

###Shan Li Nio, 6222420


![Introduction](https://github.com/SLNio/Final-Project/blob/master/doc/intro_screen.jpg)

![Resistance](https://github.com/SLNio/Final-Project/blob/master/doc/antibiotic_resistance_screen.jpg)

![Consumption](https://github.com/SLNio/Final-Project/blob/master/doc/antibiotic_consumption_screen.jpg)

![References](https://github.com/SLNio/Final-Project/blob/master/doc/reference_screen.jpg)


##Objective
Due to the worldwide frequent use of antibiotics, the number of bacteria resistant to these antibiotics is increasing. This webpage was designed to make people more aware of which types of antibiotic resistance exist and which pathogenic bacteria developed resistance. It also makes people aware of the consumption of several of these antibiotic families in european countries. 

The webpage is divided into four sections: a small introduction to the subject, an antibiotic resistance section with a stretched chord diagram to view all existing links between antibiotics and bacteria, an antibiotic consumption section with a chloropleth map of europe and a barchart which shows the consumption of antibiotic families per european country and a reference section.

##Technical Design


###Overview
All code was separated into six different javascript files: one file each for the three datavisualisations, a file for the introduction animation, an index file, which initiates all visualisations when loaded for the first time and a file with helper functions.
When the webpage is loaded, all visualisations and animations will be drawn with initial values that are defined in index.js. By using the radio button, the drawChord function can be recalled with different data. The datamap can also be recalled with different data at the moment when a user selects an antibiotic family in the stretched chord diagram. When the user selects a country in the datamap the barchart data can be changed. 

###Implementation of the stretched chord-diagram visualisation
The implementation of the stretched chord-diagram was based on an example at the d3 page (http://www.visualcinnamon.com/2015/08/stretched-chord.html). Since the antibiotics data of this visualisation can be changed with a radio button, it was necessary to define all data elements in the same file as where the drawChord function was called, which is index.js. Since the two antibiotics options also required different settings, two data objects were created. These were coupled to the options of the radio button. To differentiate between bacteria, antibiotic families and individual antibiotics, I've deciced to use the indeces. In order to do that element names were stored in a list called element. In this way sections of data could be excluded and it was possible to loop over all different data elements, when implementing interactive elements or drawing components. The stretched chord diagram contains multiple interactive components, such as the ability to hover over the outer arcs or the inner chords. By doing so the user is able to select a specific link or to see the links for a selected outer arc item. Codewise this is done using a fade function in helper_functions.js which decreases the opacity of all links that are not related to the users selection. It was chosen on purpose to have duplicate code in order to reset and apply these opacity effects, so the fade function only had to be called once from the drawChord function, instead of twice, thereby passing on different arguments for the reset and the appliance. When hovered over the inner chords a tooltip with the exact antibiotic resistance percentage is shown. Additionally it is able to click on the outer arc elements. This will open a textbox which allows the user to get more information about a clicked item. Last of all the stretched chord diagram is linked to a search/selection bar. By choosing an option from the selection menu, chords related to this selection are shown, while all other chords are again made invisible by the fade function. Both the textbox and the selection bar contain a close button, so the users selection can be cancelled. Since I did not have consumption data of all antibiotic families that are shown in the stretched chord diagram I decided to accentuate the families with consumption data with a bold font, to make it more clear for users that they are special. By clicking these accentuated antibiotic families the user can determine which consumption data will be shown in the datamap, this choice will also affect which bar (antibiotic family) is highlighted in the barchart. Since there is an interactive link between the stretched chord diagram and the datamap, a function for an automatic scroll was implemented, which will be called when an accentuated antibiotic family is clicked by the user. This was done to reduce the amount of scrolling by the user himself.

###Interactive elements
Besides the radio button that was discussed before, the other interative element that was included is a selection bar. Even as the chord diagram, the content of the selection menu can be changed by the radio button. Other interactive elements of the webpage include the navigation bar which allows the user to navigate to the different webpage sections. Furthermore hyperlinks to webpages of the datasources were implemented in the reference sections. The introduction section is not interactive, however it is provided with an animation instead. This animation prevents users from reading large pieces of text, but serves them small sections at a time.  

###Implementation of the datamap
The datamap is colored according to the fillkey-groups that are created. The antibiotics consumption data was divided over seven of these groups using a for loop function called getCountryGroup in helper_functions.js. The ranges of each group were manually set and stored in a list called domains. Since the penicilin consumption data contained much greater values, it was necessary to create a separate domain list for this family. This also required implementation of a control statement to check if the family that is clicked in the stretched chord diagram is penicillins or not. It was chosen to limit the groups to seven to make it easier for users to differentiate between the different colors. These colors were hardcoded. Also in the drawMap function I used indeces to differentiate between antibiotic families. First of all a list was created with all antibiotic families that have consumption data. When the user selects a family in the stretched chord diagram, the index of this family is passed on to the drawMap function, this index corresponds to the index of the created list. In this way a data object could be created which has the index that was passed on as key for the consumption data of that particular family. This data object functioned as value for a second data object, which has a country code as key. In this way it can be checked wether there is consumption data for a certain country. This is important for coloring the map, for the tooltip function and for drawing the barchart. When hovered over the countries two things happen: a tooltip with the exact consumption data appears and the color of the selected country changes. The color of the countries also changes when clicked. However these selected countries also need to be able to change back again when an alternative selection is made by the user. Therefore two functions were created: an on.click and a mouseenter and a mouseleave function. These functions need to keep track of both the country that is selected and the country that was selected before. With the second value they can call the getCountryGroup function again to assign the country to the correct group and fillcolor. The mouseleave function was implemented to prevent the outside countries from remaining colored with the mouseenter color when the user leaves the datamap window. Besides the family index, also the name of the antibiotic family was passed on to the drawMap function in order to change the graph title dynamically. By clicking on the countries the user can determine which consumption data will be shown in the barchart. Furthermore a zoom function was used on the world datamap in which the projection was set at Europe, since I could not find a proper datamap of Europe only.

###Implementation of the barchart
For the barchart two functions were written: one will draw a new barchart (in case when the webpage was loaded or after an apology text) while the other will only update the barchart with new data. This was done, since there are two different situations. In the first situation there is already a barchart drawn when the user selects a different country in the datamap. In this case only the bars, the y-axis  and the title need to be updated, while all other elements, such as the shape of the tooltips and the x-axis remain similar. Therefore the updateBar function only reloads the data needed for the bars and y-axis and smoothly redraws them, because of an implemented transition. In the second situation there is no barchart drawn yet, therefore all barchart elements need to be initialized, which is done in the drawBarchart function. To prevent duplication of variables the updateBar function was placed inside the drawBarchart function. However this function still needed to be accessible from the datamap function, without calling the drawBarchart function first. To solve this problem the updateBarchart function was stored into a variable, which was initiated at the top of the d3_barchart.js file. Also the barchart title changes dynamically, therefore the countryname of the datamap selection was passed on to the barchart functions. An additional interactive element of the barchart is the tooltip with the exact consumption value, which appears when hovered over the different bars. 


##Design Choices


###Color
Since the subjects of the webpage include medicines and bacteria I have tried to create a clinical appearance. In order to do this I have chosen different shades of turqoise as theme color, completed with pictures of antibiotics and bacteria. For the datamap shades of red were chosen as a varation on the turqoise colors. Additionally these red colors were chosen to create an alarming effect for the user, since high consumption of antibiotics can be associated with an increase in the development of resistant bacteria. A contrasting color needed to be chosen for the on.hover and on.click events. To keep contrasts color-blind friendly and to stick to the color theme of the webpage turqoise shades of color were used. These colors were also used for the barchart. To make the link between the datamap and the barchart more clear for the user, the color of a selected country is similar to the highlighted bar. The highlight of the bar shows the user which antibiotic consumption is shown in the datamap.

##Challenges
The first challenge that was met, was to think of a good way to visualise the links between antibiotics and resistant bacteria. The initial idea was to visualise these two groups and the links between them by creating an inner circle and an outer circle with chords between them representing the links. However I quickly noticed that this would be a bit ambitious to incorporate into 3 weeks, since there were no existing examples online. Furthermore there was a chance that it would look really chaotic, because linking an innercircle with an outercircle would automatically involve a high number of intersections between chords. When the initial idea was changed to implementation of a stretched chord diagram I assumed that the biggest challenge would be the implementation of this diagram, since I did not have experience with chord diagrams at that time. However this appeared to be the least of all the challenges that I've experienced. Most of the time was spend on getting data in the correct format for the chord diagram, which was also one of the points I assumed to be a challenge. Furthermore many hours were spend on the implementation of the radio button and the selection bar. This appeared to be a real challenge, since I had to re-organize all my functions and data, so it would be easy to exchange data. Furthermore I needed to use jQuery for both interactive elements, which required some more studying of examples than it would have required when I had used D3. Despite these challenges I mainly sticked to my initial idea. I've implemented a chord diagram-like visualisation, a datamap, a bar chart, a radio button and a selection bar. Therefore I can conclude that the plans that I've made at the start of the project were reasonable for the amount of time. 

##Code improvement

![BCH](https://github.com/SLNio/Final-Project/blob/master/doc/BCH_2.PNG)

After organizing all my javascript, css, img and text files in different folders to make my code more accessible I already improved my code with one point. Furthermore I moved certain functions to the helper functions, to keep units of code more simple in the datavisualisation files and to reduce the total amount of code in these files. In this way the datavisualisation files became more easy to read, not only because the amount of code reduced, but also since the number of branch points reduced. Furthermore this occasionally solved the problem of code lines that were longer than the size of 80 characters. With these code improvements I earned two extra points for my code, resulting in a score of 7 out of 10.


##Additional ideas
If I had more time I would have made an animation for my stretched chord diagram to give the user a clear instruction on how to interpret the diagram. In this animation the outer arcs would be drawn one by one, provided with some storyline about antibiotics and antibiotic resistance. Thereafter chords would be drawn to show how the appearance/dissapearance of the links work and to show how the tooltips appear on hover. Then the user also would get to see that when an outer arc element is clicked a new window is opened with additional information about the selected object. This animation would have not be necessary, but it would have created a more appealing story. Besides the animation I would have spend more time on improving the webpage. For the introduction page for example I would have liked to create several buttons, for example to go to the previous or next text section, to skip the intro and to reset the text animation. I would also have worked on a smooth transition in changing the left arc of the stretched chord diagram. Furthermore I would have spend more time on resizing page elements when enlarging or minimizing the screen. I might also have tried to implement my initial idea of an inner circle into an outer circle just to create a complete new datavisualisation that have not yet been made before. 

What also would have need improvement are the functions to show the info about the stretched chord diagram items. This code contains a lot of duplication. Due to the shortage of time I did not create a new function in helper_functions, since I also noticed that I would need to pass on a lot of arguments since the infotext format slightly differs for bacteria, individual antibiotics and antibiotic families. Furthermore it would have been more nice if I would have set the spaces between lines with html and css, instead of with `<br>` tags. Furthermore I also would have liked to implement an instruction text for the stretched chord diagram, to make it clear for the user that outer arc elements are clickable. 
